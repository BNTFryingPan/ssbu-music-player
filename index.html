<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Music Player</title>

        <link rel="stylesheet" href="style.css">
        <script>
            //var audioCtx = new AudioContext();
            //var audioElem;
            //var src;
            //var gainNode;
            // http://wiki.hydrogenaud.io/index.php?title=ReplayGain_specification
            // TODO: do the loudness filtering (Butterworth, Yulewalk) IIR filters
            function normalizedAudioElement(name) {
                //audioElem = document.getElementById(name);
                //src = audioCtx.createMediaElementSource(audioElem);
                //gainNode = audioCtx.createGain();
                //gainNode.gain.value = 1;
                //connectAudioNormalizer();
            }

            function connectAudioNormalizer() {
                //src.connect(gainNode);
                //gainNode.connect(audioCtx.destination);
            }

            function disconnectAudioNormalizer() {
                //src.disconnect(gainNode);
                //gainNode.disconnect(audioCtx.destination);
            }
        </script>

    </head>
    <body id="body" data-currentLevel="top-menu" data-prevLevel="top-menu" data-musicInfoOpen="false" data-settingsOpen="false">
        <div id='hidden-stuff' style='display: none'>
            <audio id="song">ok boomer</audio>
        </div>

        <header id="titlebar">
            <div id="drag-region">

                <div id="window-title">
                    <span id="window-title-text">Vault > Sounds</span>
                </div>

                <div id="window-controls">
                    <div class="button" id="min-button" title="Minimize">
                        <span>&#xE921;</span>
                    </div>
                    <div class="button" id="max-button" title="Maximize">
                        <span>&#xE922;</span>
                    </div>
                    <div class="button" id="restore-button" title="Restore">
                        <span>&#xE923;</span>
                    </div>
                    <div class="button" id="close-button" title="Close">
                        <span>&#xE8BB;</span>
                    </div>
                    <div class="button" id="settings-button" title="Settings">
                        <span></span>
                    </div>
                    <div class="button" id="back-button" title="Back" style='display:none'>
                        <span></span>
                    </div>

                </div>
            </div>
        </header>

        
        <div id='main'>
            <div id='top-settings' style='display: none'>
                <table>
                    <tr>
                        <td>Enable Windows 10 Acrylic Background</td>
                        <td><input id="settings-acrylic" type="checkbox" checked></td>
                    </tr>
                    <tr>
                        <td><input id='settings-refresh-albums' value="Refesh Album List" type="button" onclick="loadAlbums()"></td>
                    </tr>
                    <tr>
                        <td><input id='settings-update' value="Check for updates" type="button"></td>
                    </tr>
                    <tr title="When enabling again, will take effect when the next song starts playing">
                        <td>Enable Volume Normalization</td>
                        <td><input id="settings-normalization" type="checkbox" checked onclick="updateNormalizationState(this.checked)"></td>
                    </tr>
                    <tr>
                        <td>idk, more settings soon probably</td>
                    </tr>
                    <!--<tr>
                        <td>
                            <iframe width="560" height="315" src="https://www.youtube.com/embed/eKC2ykkYWDY?controls=0" frameborder="0" allow="accelerometer; autoplay; encrypted-media; gyroscope; picture-in-picture" allowfullscreen></iframe>
                        </td>
                    </tr>-->
                </table>
                
                <div id='settings-info'>Version Alpha 0.3.2<br>TheDerpyMemeSquad</div>
            </div>
            <div id='top-menu'>
                <div id="top-music-button" onclick="loadAlbums();openMusicMenu();" class="top-button select-hover-anim">
                    Music
                </div>
                <div id="top-playlist-button" onclick="openPlaylistMenu()" class="top-button select-hover-anim">
                    Playlists
                </div>
                <div id="top-services-button" onclick="openServicesMenu()" class="top-button select-hover-anim">
                    Services
                </div> 
                
                <div id='top-footer-bar'>

                </div>
            </div>

            <div id="normal" hidden>
                <div class="now-playing-spacer"></div>
                
                <div id="album-info-header">
                    <img id="album-info-header-img" class="album-logo" src='./other-album.png' width="12%">
                    <div id="album-info-header-thing"></div>
                    <span id="album-info-header-thing-text">asdf</span>
                </div>
                
                <div id="services" style="display:none">
                    <div style="height: calc(9em)"></div>
                    <div id="s-content">
                        <div id="s-yt-test-area">
                            <div id="player"></div>
                            <!--<script>
                                // 2. This code loads the IFrame Player API code asynchronously.
                                var tag = document.createElement('script');

                                tag.src = "https://www.youtube.com/iframe_api";
                                var firstScriptTag = document.getElementsByTagName('script')[0];
                                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

                                // 3. This function creates an <iframe> (and YouTube player)
                                //    after the API code downloads.
                                var player;
                                function onYouTubeIframeAPIReady() {
                                    player = new YT.Player('player', {
                                    height: '390',
                                    width: '640',
                                    videoId: 'eKC2ykkYWDY',
                                    events: {
                                        'onReady': onPlayerReady,
                                        'onStateChange': onPlayerStateChange
                                    }
                                    });
                                }

                                // 4. The API will call this function when the video player is ready.
                                function onPlayerReady(event) {
                                    event.target.playVideo();
                                }

                                // 5. The API calls this function when the player's state changes.
                                //    The function indicates that when playing a video (state=1),
                                //    the player should play for six seconds and then stop.
                                var done = false;
                                function onPlayerStateChange(event) {
                                    if (event.data == YT.PlayerState.PLAYING && !done) {
                                    setTimeout(stopVideo, 6000);
                                    done = true;
                                    }
                                }
                                function stopVideo() {
                                    player.stopVideo();
                                }
                            </script>-->
                        </div>
                        <div id="s-twitch-div">
                            <span>Twitch Integration</span>
                            <input type="button" value="Sign in with Twitch" onclick="beginTwitchOauthFlow()"><br>
                            <span>Enable Songrequest:</span> <input type="checkbox"><br>
                            
                            Who should be allowed to request songs?<br>
                            <table onclick="updateTwitchSrPerms()">
                                <tr title="Moderators only">
                                    <td style="padding-right:2em">Moderators:</td>
                                    <td><input name="s-t-sr-perm" type="radio" id="s-t-perm-mod"></td>
                                </tr>
                                <tr title="VIPs and Moderators">
                                    <td>VIPs:</td>
                                    <td><input name="s-t-sr-perm" type="radio" id="s-t-perm-vip"></td>
                                </tr>
                                <tr title="Subs, VIPs, Mods">
                                    <td>Subscribers:</td>
                                    <td><input name="s-t-sr-perm" type="radio" id="s-t-perm-sub"></td>
                                </tr>
                                <!--<tr title="Subs, Vips, Mods"> Commented out because this wont work quite yet
                                    <td>Subscribers or VIP:</td>
                                    <td><input name="s-t-sr-perm" type="radio" id="s-t-perm-suborvip"></td>
                                </tr>-->
                                <tr title="Anyone">
                                    <td>Anyone:</td>
                                    <td><input name="s-t-sr-perm" type="radio" id="s-t-perm-all"></td>
                                </tr>
                            </table>
                        </div>
                    </div>
                </div>


                <div id='list-container'>
                    <div style="height: calc(9em)"></div>
                    <div id="song-list" style="display: none">
                        <table id='song-list-t'>
                            <tbody id='song-list-tbody'>
                                <tr><td></td><td>0</td><td>Example Song</td><td>0:00</td></tr>
                            </tbody>
                        </table>
                    </div>
                    <div id='album-list' style="display: none"></div>
                    <div id="playlist-list" style="display: none"></div>
                </div>
            </div>


            <div id='now-playing' class='no-song' hidden>
                <div id='song-alb-img'>
                    <img id='song-info-art' class="album-logo" src='./other-album.png' width="50%">
                    <span>Local Files</span>
                </div>
                <div id='song-info'>
                    <input type="button" onclick="toggleSongInfoModal()" value="Song Info" id="song-info-button">
                    <div id="advanced-song-info-modal" style="display: none">
                        <input type="button" onclick="toggleSongInfoModal(false)" value="Back" id="song-info-close">
                        <span id="song-info-title2">title - album - artist</span><br>
                        <span id="song-info-genre">genre - comment</span><br>
                        <span id="song-info-line1">year - mm:ss - disk/total - track/total</span><br>
                        Format: <span id="song-info-line2">MP3 - MPEG - lossless</span><br>
                        Normalization Gain: <span id='song-info-normalization'>{null}</span>
                    </div>
                    <div id="song-info-title"></div>
                    <div id="song-info-album"></div>
                    <div id="song-info-artist"></div>
                </div>
                <div id='song-controls'>
                    <input type="range" step="0.000001" value=1 max=1 min=0 id="now-playing-volume-slider" oninput="updateVolume()" class="seek-slider">
                    <input type="range" step="0.000001" id="now-playing-seek-slider" oninput="updateSongProgressFromBar()" class="song-progress seek-slider">
                    <span id='shuffle-state'>Random</span>
                    <input type="button" id="np-prev"    value="prev"    onclick="prevSong()">
                    <input type="button" id="np-pause"   value="pause"   onclick="pauseSong()"> 
                    <input type="button" id="np=next"    value="next"    onclick="nextSong()">
                    <input type="button" id="np-shuffly" value="shuffle" onclick="shuffleSongs()">
                </div>
                <canvas id='visualizer-canvas'></canvas>
            </div>
            
            
        </div>
    </div>

        <script>
            // You can also require other files to run in this process
            require('./renderer.js');
            //normalizedAudioElement("song");
        </script>
        <script src="./js/playlists.js"></script>
        <script src="./js/songs.js"></script>
        <script src="./js/albums.js"></script>
        <script src="./js/music-player.js"></script>
        <script src="./js/folder-data.js"></script>
        <script src="./js/ui.js"></script> 
        <script src="./js/twitch.js"></script>
    </body>
</html>